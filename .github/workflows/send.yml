name: "30-Minute Telegram Bot"
on:
  # Ø¯Ùˆ trigger Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†
  schedule:
    - cron: "0,30 * * * *"  # Ø¯Ù‚ÛŒÙ‚Ù‡ 0 Ùˆ 30 Ù‡Ø± Ø³Ø§Ø¹Øª UTC
      
  # Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ
  workflow_dispatch:
    inputs:
      force:
        description: 'Force send even if no new lines'
        required: false
        default: 'false'

jobs:
  send:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“… Calculate Iran time
        id: time
        run: |
          IRAN_TIME=$(TZ=Asia/Tehran date '+%H:%M')
          echo "iran_time=$IRAN_TIME" >> $GITHUB_OUTPUT
          echo "ğŸ“± Iran Time: $IRAN_TIME"
          
      - name: ğŸ”„ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"
          
      - name: ğŸ“¦ Install dependencies
        run: pip install requests jdatetime
        
      - name: ğŸ¤– Run Telegram Bot
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHANNEL_ID: ${{ secrets.TELEGRAM_CHANNEL_ID }}
        run: python bot.py
        
      - name: ğŸ’¾ Save progress
        if: success()
        run: |
          git config user.name "Auto Bot"
          git config user.email "bot@noreply.github.com"
          git add last_line.txt
          git commit -m "â±ï¸ Update at ${{ steps.time.outputs.iran_time }} IR" || echo "No changes"
          git push
