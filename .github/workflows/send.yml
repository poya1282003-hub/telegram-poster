name: Send Telegram Message

on:
  schedule:
    - cron: '*/30 * * * *'  # Ù‡Ø± 30 Ø¯Ù‚ÛŒÙ‚Ù‡
  workflow_dispatch:  # Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ

jobs:
  send-message:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: pip install requests jdatetime
      
    - name: Create last_line.txt if not exists
      run: |
        if [ ! -f "last_line.txt" ]; then
          echo "0" > last_line.txt
          echo "âœ… ÙØ§ÛŒÙ„ last_line.txt Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯"
        else
          echo "ğŸ“ ÙØ§ÛŒÙ„ last_line.txt Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª"
        fi
        
    - name: Show current last_line.txt
      run: |
        echo "ğŸ“„ Ù…Ø­ØªÙˆØ§ÛŒ ÙØ¹Ù„ÛŒ last_line.txt:"
        cat last_line.txt || echo "ÙØ§ÛŒÙ„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯"
        
    - name: Run Telegram Bot
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHANNEL_ID: ${{ secrets.TELEGRAM_CHANNEL_ID }}
      run: |
        echo "ğŸ¤– Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª..."
        python bot.py
        echo "ğŸ¤– Ù¾Ø§ÛŒØ§Ù† Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª"
        
    - name: Commit and push changes
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git add last_line.txt
        
        if git diff --staged --quiet; then
          echo "âœ… Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ø¨Ø±Ø§ÛŒ commit ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯"
        else
          git commit -m "ğŸ¤– Auto-update last_line.txt [skip ci]"
          git push
          echo "ğŸ‰ ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª push Ø´Ø¯"
        fi
