name: "Send Telegram Message"
on:
  schedule:
    # Ù‡Ø± Û³Û° Ø¯Ù‚ÛŒÙ‚Ù‡ (Ø¯Ù‚ÛŒÙ‚Ù‡ Û° Ùˆ Û³Û° Ù‡Ø± Ø³Ø§Ø¹Øª)
    - cron: "0,30 * * * *"
  workflow_dispatch:  # Ø§Ù…Ú©Ø§Ù† Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ

jobs:
  send:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"
          
      - name: Install dependencies
        run: pip install requests jdatetime
          
      - name: Create last_line.txt if missing
        run: |
          if [ ! -f "last_line.txt" ]; then
            echo "0" > last_line.txt
            echo "âœ… last_line.txt created"
          fi
          
      - name: Run Telegram Bot
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHANNEL_ID: ${{ secrets.TELEGRAM_CHANNEL_ID }}
        run: python bot.py
          
      - name: Commit and push changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # ÙÙ‚Ø· Ø§Ú¯Ø± ØªØºÛŒÛŒØ±ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ commit Ú©Ù†
          git add last_line.txt
          if git diff --cached --quiet; then
            echo "âœ… No changes to commit"
          else
            git commit -m "ğŸ¤– Auto-update: last_line.txt"
            git push
            echo "âœ… Changes pushed successfully"
          fi
