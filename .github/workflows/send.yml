name: Send Telegram Message

on:
  schedule:
    - cron: '*/30 * * * *'  # Ù‡Ø± 30 Ø¯Ù‚ÛŒÙ‚Ù‡
  workflow_dispatch:  # Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ

jobs:
  send-message:
    runs-on: ubuntu-latest
    
    # ğŸ”‘ Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù…Ù‡Ù… Ø§Ø³Øª - Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
    permissions:
      contents: write  # Ø§Ø¬Ø§Ø²Ù‡ Ù†ÙˆØ´ØªÙ† Ø¯Ø± Ø±ÛŒÙ¾Ùˆ
      pull-requests: write
      issues: write
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        # ğŸ”‘ Ø§Ø² ØªÙˆÚ©Ù† Ù…Ø®ØµÙˆØµ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: pip install requests
      
    - name: Create last_line.txt if not exists
      run: |
        if [ ! -f "last_line.txt" ]; then
          echo "0" > last_line.txt
          echo "âœ… ÙØ§ÛŒÙ„ last_line.txt Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯"
        else
          echo "ğŸ“ ÙØ§ÛŒÙ„ last_line.txt Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª"
        fi
        
    - name: Show current last_line.txt
      run: |
        echo "ğŸ“„ Ù…Ø­ØªÙˆØ§ÛŒ ÙØ¹Ù„ÛŒ last_line.txt:"
        cat last_line.txt || echo "ÙØ§ÛŒÙ„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯"
        
    - name: Run Telegram Bot
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHANNEL_ID: ${{ secrets.TELEGRAM_CHANNEL_ID }}
      run: |
        echo "ğŸ¤– Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª..."
        python bot.py
        echo "ğŸ¤– Ù¾Ø§ÛŒØ§Ù† Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª"
        
    - name: Show updated last_line.txt
      run: |
        echo "ğŸ“„ Ù…Ø­ØªÙˆØ§ÛŒ Ø¬Ø¯ÛŒØ¯ last_line.txt:"
        cat last_line.txt || echo "ÙØ§ÛŒÙ„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯"
        
    - name: Commit and push changes
      run: |
        echo "ğŸ’¾ Ø´Ø±ÙˆØ¹ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ ØªØºÛŒÛŒØ±Ø§Øª..."
        
        # ØªÙ†Ø¸ÛŒÙ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        
        # Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„
        git add last_line.txt
        
        # Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ ØªØºÛŒÛŒØ±ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
        if git diff --staged --quiet; then
          echo "âœ… Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ø¨Ø±Ø§ÛŒ commit ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯"
        else
          echo "ğŸ“ ØªØºÛŒÛŒØ±Ø§Øª Ù¾ÛŒØ¯Ø§ Ø´Ø¯ - Ø¯Ø± Ø­Ø§Ù„ commit..."
          git commit -m "ğŸ¤– Auto-update last_line.txt [skip ci]"
          
          echo "ğŸ“¤ Ø¯Ø± Ø­Ø§Ù„ push Ø¨Ù‡ Ø±ÛŒÙ¾Ùˆ..."
          git push
          echo "ğŸ‰ ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª push Ø´Ø¯"
        fi
        
        echo "ğŸ’¾ Ù¾Ø§ÛŒØ§Ù† Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ"
        
    - name: Verify push
      run: |
        echo "ğŸ” ØªØ£ÛŒÛŒØ¯ Ø¢Ø®Ø±ÛŒÙ† ÙˆØ¶Ø¹ÛŒØª..."
        echo "Ø¢Ø®Ø±ÛŒÙ† commit:"
        git log --oneline -1
- name: Install dependencies
  run: |
    pip install requests
    pip install jdatetime  # ğŸ‘ˆ Ø§ÛŒÙ† Ø®Ø· Ø±Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
